---
tags:
    - ts
---

# å‡½æ•°

## å‡½æ•°ç±»å‹è¡¨è¾¾å¼

```ts
function greeter(fn: (a: string) => void) {
    fn('Hello, World');
}
```

## è°ƒç”¨ç­¾å

å®šä¹‰ä¸€ä¸ªå¸¦å±æ€§çš„å‡½æ•°ï¼š

```ts {1-4}
type DescribableFunction = {
    description: string;
    (someArg: number): boolean; // æ³¨æ„æ˜¯ `:` è€Œä¸æ˜¯ `=>`
};

function doSomething(fn: DescribableFunction) {
    console.log(fn.description + ' returned ' + fn(6));
}
```

## æ„é€ ç­¾å

```ts
type SomeConstructor = {
    new (s: string): SomeObject;
};

function fn(ctor: SomeConstructor) {
    return new ctor('hello');
}
```

å¦‚æœæ—¢æ˜¯æ„é€ å‡½æ•°ï¼Œåˆæ˜¯æ™®é€šå‡½æ•°ï¼š

```ts
interface CallOrConstruct {
    new (s: string): Date;
    (n?: number): number;
}
```

## æ³›å‹å‡½æ•°

```ts
// èƒ½è‡ªåŠ¨æ¨æ–­è¿”å›å€¼ç±»å‹ä¸º `Type[]`
function combine<Type>(arr1: Type[], arr2: Type[]): Type[] {
    return arr1.concat(arr2);
}
```

å¯ä»¥è¿›è¡Œç±»å‹çº¦æŸï¼š

```ts
function longest<Type extends { length: number }>(a: Type, b: Type) {
    return a.length >= b.length ? a : b;
}
```

ç±»å‹çº¦æŸä¸­ï¼Œæ³¨æ„è¿”å›å€¼ç±»å‹çš„æ ‡æ˜ï¼š

```ts {8}
function minimumLength<Type extends { length: number }>(
    obj: Type,
    minimum: number,
): Type {
    if (obj.length >= minimum) {
        return obj;
    } else {
        return { length: minimum } as Type;
    }
}
```

### å¦‚ä½•ä½¿ç”¨å¥½æ³›å‹å‡½æ•°

#### ç±»å‹ä¸‹æ”¾

```ts
// Good
function fn1<Type>(arr: Type[]) {}

// Bad
function fn2<Type extends any[]>(arr: Type) {}
```

#### é¿å…å†—ä½™çš„ç±»å‹å‚æ•°

```ts
// Good
function filter1<Type>(arr: Type[], fn: (arg: Type) => boolean): Type[] {
    return arr.filter(fn);
}

// Bad
function filter2<Type, Fn extends (arg: Type) => boolean>(
    arr: Type[],
    fn: Fn,
): Type[] {
    return arr.filter(fn);
}
```

## å¯é€‰å‚æ•°

ç”¨ `?` æˆ–è€…è®¾é»˜è®¤å€¼æ¥ä½¿ä¸€ä¸ªå‡½æ•°å‚æ•°å¯é€‰ï¼š

```ts
// ä»¥ä¸‹ `x` å®é™…çš„ç±»å‹å‡ä¸º `number | undefined`
function fn1(x?: number) {}
function fn2(x = 10) {}
```

## å‡½æ•°é‡è½½

ä½ å¯ä»¥å¯¹ä¸€ä¸ªå‡½æ•°å†™å¤šä¸ª*é‡è½½*ç­¾åï¼ŒåŒæ—¶å¿…é¡»æœ‰ä¸€ä¸ª*å®ç°*ç­¾åï¼Œä¸”å…¼å®¹è¿™äº›é‡è½½ç­¾åï¼š

```ts
// é‡è½½ç­¾å
function makeDate(timestamp: number): Date;
function makeDate(m: number, d: number, y: number): Date;
// å®ç°ç­¾åï¼ˆéœ€è‡ªè¡Œåˆ¤æ–­é‡è½½ï¼‰
function makeDate(mOrTimestamp: number, d?: number, y?: number): Date {
    if (d !== undefined && y !== undefined) {
        return new Date(y, mOrTimestamp, d);
    } else {
        return new Date(mOrTimestamp);
    }
}

const d1 = makeDate(12345678);
const d2 = makeDate(5, 5, 5);
const d3 = makeDate(1, 3); // Error: æ²¡æœ‰ä¸¤ä¸ªå‚æ•°çš„é‡è½½
```

é‡è½½ä¸­åŒä¸€ä¸ªä½ç½®çš„å‚æ•°å¯ä»¥æœ‰ä¸åŒç±»å‹ï¼ˆè¿”å›å€¼ä¹Ÿå¯ä»¥ä¸åŒï¼‰ï¼š

```ts
function isFalsy(num: number): boolean;
function isFalsy(str: string): boolean;
function isFalsy(value: number | string) {
    if (typeof value === 'number') {
        return value === 0 || isNaN(value);
    } else {
        return value === '';
    }
}

const b = isFalsy('hello'); // => false
```

> å†™å‡½æ•°æ—¶ï¼Œåº”å½“è€ƒè™‘æ˜¯å¦éœ€è¦ç”¨åˆ°é‡è½½ã€‚æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œå…¶å®å¯ä»¥å®Œå…¨å»é™¤é‡è½½ç­¾åã€‚

å‡½æ•°é‡è½½æ˜¯çµæ´»çš„è¯­æ³•ï¼Œåªè¦å®ç°ç­¾åèƒ½å…¼å®¹æ‰€æœ‰é‡è½½ç­¾åï¼Œé‡è½½ç­¾åéƒ½æ˜¯åˆæ³•çš„ã€‚

## å‡½æ•°ä¸­ä½¿ç”¨ `this`

åœ¨å‡½æ•°å£°æ˜ä¸­éœ€è¦å°† `this` ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ‰èƒ½ä½¿ç”¨ `this` å€¼ï¼š

```ts
interface Person {
    name: string;
}

function greet(this: Person) {
    console.log(`Hello, I'm ${this.name}.`);
}

// å®é™…è°ƒç”¨æ—¶ä¸éœ€è¦ä¼ å…¥ `this` å‚æ•°
greet.call({ name: 'Talaxy' }); // => "Hello, I'm Talaxy."
```

> æ³¨æ„ï¼šåªèƒ½åœ¨å‡½æ•°å£°æ˜æˆ–å‡½æ•°è¡¨è¾¾å¼ä¸­ä½¿ç”¨ `this` ï¼Œç®­å¤´å‡½æ•°ä¸å¯èƒ½æœ‰ `this` å€¼ã€‚

å¯ä»¥å°† `this` è®¾ä¸º `void` æ¥ç¦æ­¢åœ¨å‡½æ•°ä¸­ä½¿ç”¨ `this` ï¼š

```ts
interface Person {
    name: string;
    greet: (this: void) => void;
}

const person: Person = {
    name: 'Talaxy',
    greet() {
        // ERROR: `void` ç±»å‹ä¸å­˜åœ¨ `name` å±æ€§
        console.log(`Hello, I'm ${this.name}.`);
    },
};
```

## å…¶ä»–éœ€è¦äº†è§£çš„ç±»å‹

### `void`

`void` ä½œä¸ºå‡½æ•°è¿”å›å€¼ç±»å‹æ—¶ï¼ˆ TS çš„è§†è§’ï¼‰ä¼šå¿½ç•¥å‡½æ•°ä½“ä¸­çš„ä»»ä½•è¿”å›ï¼š

```ts
type VoidFn = () => void;

const fn: VoidFn = () => {
    return 'hello';
};

fn().length; // ERROR: `void` ç±»å‹ä¸å­˜åœ¨ `length` å±æ€§
```

> ä½†åœ¨å®é™…æ‰§è¡Œä¸­ `fn()` ä¾æ—§ä¼šè¿”å› "hello" ã€‚

åœ¨å‡½æ•°ä¸­ï¼Œè‹¥æ²¡æœ‰ä»»ä½•æ˜ç¡®å€¼è¿”å›ï¼ŒTS ä¼šå°†è¿”å›å€¼æ¨æ–­ä¸º void ï¼›å¦‚æœåœ¨å‡½æ•°å®šä¹‰æ—¶å°†è¿”å›å€¼è®¾ä¸º `void` ï¼Œåˆ™å‡½æ•°ä½“é‡Œç¦æ­¢ä»»ä½•æ˜ç¡®å€¼è¿”å›ã€‚

```ts
const fn = (): void => {
    return 10; // ERROR: ä¸èƒ½å°† `number` èµ‹å€¼ç»™ `void` ç±»å‹
};
```

### `object`

`object` ä»£è¡¨ä¸€ä¸ªéåŸå§‹å€¼ï¼Œå³å¯¹è±¡ï¼Œä½†ä¸å…¨å±€ç±»å‹ `Object` ä¸åŒã€‚

åœ¨ TS ä¸­ï¼Œä½ å¯èƒ½æ°¸è¿œä¸ä¼šå°† `Object` ä½œä¸ºç±»å‹ã€‚

### `unknown`

ä¸ `any` ç±»ä¼¼ï¼Œ`unknown` ä»£è¡¨ä»»ä½•å€¼ï¼Œä½†æ˜¯æ„ä¸ºâ€œæœªçŸ¥â€ï¼Œè¡¨ç¤ºä¸èƒ½ç”¨ `unknown` å€¼åšä»»ä½•äº‹ï¼š

```ts
const a: any = 12.34;
const b: unknown = 12.34;
a.toFixed(); // => "12"
b.toFixed(); // ERROR: `a` æ˜¯ä¸ªæœªçŸ¥ç±»å‹
```

å°† `unknown` ä½œä¸ºå‡½æ•°è¿”å›å€¼ç±»å‹ï¼š

```ts
function safeParse(s: string): unknown {
    return JSON.parse(s); // `JSON.parse` çš„è¿”å›å€¼ä¸º `any`
}

// éœ€è¦å¯¹ `obj` åšç±»å‹è½¬æ¢æ‰å¯ä»¥åˆæ³•ä½¿ç”¨
const obj = safeParse(someRandomString);
```

### `never`

`never` ä»£è¡¨ä¸å¯èƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œæ¯”å¦‚å‡½æ•°æŠ›å‡ºäº†å¼‚å¸¸æˆ–ç»ˆæ­¢äº†ç¨‹åºã€‚

æ­¤å¤–ï¼Œ`never` è¿˜å¯ä»¥ä»£è¡¨å‡½æ•°ä½“ä¸­çš„ç±»å‹è¾¹ç•Œï¼ˆç»™ TS è‡ªå·±ç”¨çš„ï¼Œæ­£å¸¸äººç”¨ä¸åˆ° ğŸ˜… ï¼‰ï¼š

```ts
function fn(x: string | number) {
    if (typeof x === 'string') {
        // ...
    } else if (typeof x === 'number') {
        // ...
    } else {
        x; // x çš„ç±»å‹ä¸º 'never'
    }
}
```

### `Function`

ä¸ JS ä¸­çš„ `Function` ä¸€è‡´ã€‚

`Function` ç±»å‹å…è®¸ä¼ å…¥ä»»æ„å‚æ•°ï¼Œè¿”å›å€¼å§‹ç»ˆä¸º `any` ã€‚æœ€å¥½ä¸è¦ç”¨è¿™ä¸ªç±»å‹ã€‚

## å‰©ä½™å‚æ•°

### å‰©ä½™å½¢å‚

å‰©ä½™å½¢å‚çš„ç±»å‹åº”å½“ä¸ºä¸€ä¸ªæ•°ç»„ï¼ˆ `Array<T>` æˆ– `T[]` ï¼‰ï¼š

```ts
function multiply(n: number, ...m: number[]) {
    return m.map((x) => n * x);
}
```

### å‰©ä½™å®å‚

å¯ä»¥é€šè¿‡æ•°ç»„å±•å¼€è¯­æ³•ä¼ å…¥å®å‚ï¼š

```ts
const arr1 = [1, 2, 3];
const arr2 = [4, 5, 6];
arr1.push(...arr2);
```

å¯¹äºæ— å‰©ä½™å½¢å‚çš„å‡½æ•°åº”å½“ä½¿ç”¨å…ƒç»„ï¼ˆè€Œéä¸€èˆ¬æ•°ç»„ï¼‰ï¼š

```ts
const args: [number, number] = [8, 5];
const angle = Math.atan2(...args);
```

## å‚è€ƒ

[More on Functions - TypeScript](https://www.typescriptlang.org/docs/handbook/2/functions.html)
